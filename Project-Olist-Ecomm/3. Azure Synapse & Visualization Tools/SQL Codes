--1
SELECT 
     *
FROM 
    OPENROWSET(
        BULK 'https://olistdatastorageaccanshu.dfs.core.windows.net/olistdata/silver/full_orders_df.parquent/',
        FORMAT = 'PARQUET'

    )AS result1


--2

create schema gold

create view gold.full_orders
as 
SELECT 
    *
FROM 
    OPENROWSET(
        BULK 'https://olistdatastorageaccanshu.dfs.core.windows.net/olistdata/silver/full_orders_df.parquent/',
        FORMAT = 'PARQUET'

    )AS result1


SELECT * FROM gold.full_orders

--3

create view gold.full_orders2
as 
SELECT 
    *
FROM 
    OPENROWSET(
        BULK 'https://olistdatastorageaccanshu.dfs.core.windows.net/olistdata/silver/full_orders_df.parquent/',
        FORMAT = 'PARQUET'

    )AS result2
WHERE order_status = 'delivered'


SELECT * FROM gold.full_orders2

--4

--CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'IRONman@1234';

--CREATE DATABASE SCOPED CREDENTIAL anshumanadmin WITH IDENTITY = 'Managed Identity';

--SELECT * FROM sys.database_credentials

CREATE EXTERNAL FILE FORMAT extfileformat WITH (
    FORMAT_TYPE = PARQUET,
    DATA_COMPRESSION = 'org.apache.hadoop.io.compress.SnappyCodec'
);

CREATE EXTERNAL DATA SOURCE goldlayer WITH (
    LOCATION = 'https://olistdatastorageaccanshu.dfs.core.windows.net/olistdata/gold',
    CREDENTIAL = anshumanadmin
);


CREATE EXTERNAL TABLE gold.full_orders_table WITH (
        LOCATION = 'FinalServing',
        DATA_SOURCE = goldlayer,
        FILE_FORMAT = extfileformat
) AS
SELECT * FROM gold.full_orders2;